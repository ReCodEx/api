#
# WARNING: it is CRITICAL that this file & directory are NOT accessible directly via a web browser!
# https://nette.org/security-warning
#
parameters:
  uploadDir: %appDir%/../uploaded_data

  accessManager:
    leeway: 60
    issuer: https://recodex.projekty.ms.mff.cuni.cz
    audience: https://recodex.projekty.ms.mff.cuni.cz
    expiration: 86400
    usedAlgorithm: HS256
    allowedAlgorithms:
      - HS256
    verificationKey: "recodex-123"

  fileServer:
    address: http://195.113.17.8:10009
    auth:
      username: "re"
      password: "codex"
    timeouts:
      connection: 500

  broker:
    address: tcp://195.113.17.8:9668
    auth:
      username: "re"
      password: "codex"
    timeouts:
      ack: 100
      send: 5000
      result: 1000

  monitor:
    address: wss://recodex.projekty.ms.mff.cuni.cz:4443/ws

  CAS:
    serviceId: "cas-uk"
    ldapConnection:
      hostname: "ldap.cuni.cz"
      base_dn: "ou=people,dc=cuni,dc=cz"
      #port: 389
      #security: SSL
      bindName: "cunipersonalid"
    fields:
      email: "mail"
      firstName: "givenName"
      lastName: "sn"

  emails:
    apiUrl: https://recodex.projekty.ms.mff.cuni.cz:4000
    footerUrl: https://recodex.projekty.ms.mff.cuni.cz
    siteName: "ReCodEx"
    githubUrl: https://github.com/ReCodEx
    from: "ReCodEx <noreply@recodex.org>"

  failures:
    emails:
      to: "Šimon Rozsíval <simon@rozsival.com>"
      from: %emails.from%
      subjectPrefix: "ReCodEx Failure Report - "

  forgottenPassword:
    redirectUrl: "https://recodex.projekty.ms.mff.cuni.cz/forgotten-password/change"
    tokenExpiration: 600 # 10 minues
    emails:
      from: %emails.from%
      subjectPrefix: "ReCodEx Forgotten Password Request - "

  mail:
    smtp: true
    host: "smtp.ps.stdin.cz"
    port: 587
    username: ""
    password: ""
    secure: "tls"
    context:
      ssl:
        verify_peer: false
        verify_peer_name: false
        allow_self_signed: true


application:
  errorPresenter: V1:ApiError
  mapping:
    *: App\*Module\Presenters\*Presenter


session:
  useCookies: 0

extensions:
  console: Kdyby\Console\DI\ConsoleExtension
  events: Kdyby\Events\DI\EventsExtension
  annotations: Kdyby\Annotations\DI\AnnotationsExtension
  doctrine: Kdyby\Doctrine\DI\OrmExtension
  fixtures: Zenify\DoctrineFixtures\DI\FixturesExtension

services:
  router: App\RouterFactory::createRouter
  - App\Security\AccessManager(%accessManager%)
  - App\Security\Authorizator
  - Nette\Mail\SmtpMailer(%mail%)
  - class: App\Console\DoctrineFixtures
    tags: [kdyby.console.command]

  # external login services
  - App\Helpers\ExternalLogin\AuthService
  - App\Helpers\ExternalLogin\CAS(%CAS.serviceId%, %CAS.ldapConnection%, %CAS.fields%)

  # helpers
  - App\Helpers\EmailHelper(@Nette\Mail\SmtpMailer, %emails%)
  - App\Helpers\FailureHelper(@Kdyby\Doctrine\EntityManager, @App\Helpers\EmailHelper, %failures%)
  - App\Helpers\BrokerProxy(%broker%)
  - App\Helpers\FileServerProxy(%fileServer%)
  - App\Helpers\SubmissionHelper
  - App\Helpers\UploadedFileStorage(%uploadDir%)
  - App\Helpers\EvaluationLoader
  - App\Helpers\ForgottenPasswordHelper(@Kdyby\Doctrine\EntityManager, @App\Helpers\EmailHelper, @App\Security\AccessManager, %forgottenPassword%)

  # models - repositories
  - App\Model\Repository\Comments
  - App\Model\Repository\Exercises
  - App\Model\Repository\Assignments
  - App\Model\Repository\ExternalLogins
  - App\Model\Repository\Groups
  - App\Model\Repository\Instances
  - App\Model\Repository\Licences
  - App\Model\Repository\Logins
  - App\Model\Repository\Permissions
  - App\Model\Repository\ReferenceExerciseSolutions
  - App\Model\Repository\ReferenceSolutionEvaluations
  - App\Model\Repository\Resources
  - App\Model\Repository\Roles
  - App\Model\Repository\Submissions
  - App\Model\Repository\SolutionEvaluations
  - App\Model\Repository\UploadedFiles
  - App\Model\Repository\Users

doctrine:
  user: 'root'
  password: ''
  dbname: 'recodex-api'
  metadata:
    App: %appDir%

fixtures:
  locale: "en_US"
  seed: 1

annotations:
  ignore:
    - LoggedIn
    - Role
    - UserIsAllowed
    - POST
    - GET
    - PUT
    - DELETE
